version: '3'

services:

        portainer:
                image: portainer/portainer:latest
                command: -H unix:///var/run/docker.sock
                restart: always
                ports:
                        - 9000:9000
                        - 8000:8000
                volumes:
                        - /var/run/docker.sock:/var/run/docker.sock

        openhab:
                build: openhab
                ports:
                        - "443:8443"
                networks:
                        - openhab_mqtt
                volumes:
                        - "/etc/localtime:/etc/localtime:ro"
                        - "/etc/timezone:/etc/timezone:ro"
                        - "./data/openhab/addons:/openhab/addons"
                        - "./data/openhab/conf:/openhab/conf"
                        - "./data/openhab/userdata:/openhab/userdata"
                environment:
                        #OPENHAB_HTTP_PORT: "8080"
                        OPENHAB_HTTPS_PORT: "8443"
                        USER_ID: "1000"
                        GROUP_ID: "1000"

        mqtt:
                image:
                        eclipse-mosquitto:latest
                networks:
                        - openhab_mqtt

        zigbee2mqtt:
                build: zigbee2mqtt
                volumes:
                        - ./data/zigbee2mqtt:/app/data
                        - /run/udev:/run/udev:ro
                devices:
                        - /dev/ttyACM0:/dev/ttyACM0
                networks:
                        - openhab_mqtt
                privileged: true
                environment:
                        - TZ=Europe/Paris

        zigbee2mqttAssistant:
                image: carldebilly/zigbee2mqttassistant
                networks:
                        - openhab_mqtt
                environment:
                        - Z2MA_SETTINGS__MQTTSERVER=mqtt
                        - TZ=Europe/Paris
                ports:
                        - 8880:80
                restart: unless-stopped


        broadlink-mqtt:
                image: dmitriy/broadlink-mqtt
                networks:
                        - openhab_mqtt
                environment:
                        - MQTT_SERVER=mosquitto
                        - MQTT_TOPIC_PREFIX=broadlink/rm-mini3/
                        - DEVICE_HOST=192.168.1.60
                        - DEVICE_MAC=34:AA:FF:CC:D5:68

        samba:
                image:
                        dperson/samba:latest
                ports:
                        - "139:139"
                        - "445:445"
                network_mode: "host"
                volumes:
                        - "./data/openhab:/data/openhab"
                environment:
                        NMBD: 'yes'
                        WORKGROUP: 'OPENHAB'
                        USER: 'test;1234;1000;test;1000'
                        SHARE: 'OpenHAB;/data/openhab;no;no;no'
                        #PERMISSIONS: 'yes'
        
        rclone_rclone:
                image: rclone/rclone
                command: rcd --rc-web-gui --rc-addr :5572 --rc-user toto --rc-pass 1234
                ports:
                        - "5572:5572"
                volumes:
                        - ./data/rclone:/config/rclone
                        - ./data/rclone:/logs
                environment:
                        - PHP_TZ=Europe/Paris
                        - PUID=1000
                        - PGID=1000


networks:
        openhab_mqtt:
